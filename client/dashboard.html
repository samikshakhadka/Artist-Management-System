<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Artist Management System - Dashboard</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <style>
        body {
            display: block;
            min-height: 100vh;
            background-color: #f5f5f5;
            padding: 0;
            margin: 0;
        }

        .dashboard-container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 20px;
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #fff;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .dashboard-title {
            margin: 0;
            color: #333;
        }

        .user-info {
            display: flex;
            align-items: center;
        }

        .user-role {
            background-color: #4d79ff;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin-right: 15px;
        }

        .tab-container {
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .tab-buttons {
            display: flex;
            padding: 0 20px;
            border-bottom: 1px solid #eee;
        }

        .tab-button {
            padding: 15px 20px;
            cursor: pointer;
            font-weight: 500;
            color: #555;
            position: relative;
            transition: all 0.3s;
            border: none;
            background: none;
        }

        .tab-button:hover {
            color: #4d79ff;
        }

        .tab-button.active {
            color: #4d79ff;
        }

        .tab-button.active::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #4d79ff;
            border-top-left-radius: 3px;
            border-top-right-radius: 3px;
        }

        .tab-content {
            display: none;
            padding: 20px;
        }

        .tab-content.active {
            display: block;
        }

        .btn-logout {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 15px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .btn-logout:hover {
            background-color: #c82333;
        }

        .btn-action {
            padding: 8px 12px;
            margin-left: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-add {
            background-color: #28a745;
            color: white;
        }

        .btn-add:hover {
            background-color: #218838;
        }

        .data-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .data-table th {
            background-color: #f8f9fa;
            font-weight: 500;
            color: #333;
        }

        .data-table tr:hover {
            background-color: #f5f5f5;
        }

        .actions-cell {
            display: flex;
            justify-content: flex-end;
        }

        .btn-view {
            background-color: #17a2b8;
            color: white;
        }

        .btn-edit {
            background-color: #ffc107;
            color: #212529;
        }

        .btn-delete {
            background-color: #dc3545;
            color: white;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }

        .pagination-button {
            padding: 8px 12px;
            margin: 0 5px;
            cursor: pointer;
            border: 1px solid #ddd;
            background-color: white;
            border-radius: 3px;
            transition: all 0.3s;
        }

        .pagination-button:hover {
            background-color: #f1f1f1;
        }

        .pagination-button.active {
            background-color: #4d79ff;
            color: white;
            border-color: #4d79ff;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 500;
            color: #333;
            margin: 0;
        }

        .modal-close {
            font-size: 24px;
            cursor: pointer;
            color: #555;
            background: none;
            border: none;
        }

        .modal-footer {
            margin-top: 20px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .song-list-modal {
            max-width: 800px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            flex: 1;
            margin-bottom: 15px;
        }

        .form-control {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .form-control:focus {
            border-color: #4d79ff;
            outline: none;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
        }

        .btn-primary {
            background-color: #4d79ff;
            color: white;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-primary:hover {
            background-color: #3a66ff;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1 class="dashboard-title">Artist Management System</h1>
            <div class="user-info">
                <span class="user-role" id="user-role-display">Role</span>
                <span id="user-name">User Name</span>
                <button class="btn-logout" id="logout-btn">Logout</button>
            </div>

            <script>
                // Format date for display
                function formatDate(dateString) {
                    if (!dateString) return '-';
                    const date = new Date(dateString);
                    return date.toLocaleDateString();
                }

                // Function to load users with pagination
                function loadUsers(page = 1) {
                    const tbody = document.querySelector('#users-table tbody');
                    tbody.innerHTML = '<tr><td colspan="7">Loading users...</td></tr>';

                    fetch(`/api/users?page=${page}&per_page=10`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.users && data.users.length > 0) {
                                tbody.innerHTML = '';
                                data.users.forEach(user => {
                                    tbody.innerHTML += `
                                <tr>
                                    <td>${user.id}</td>
                                    <td>${user.first_name}</td>
                                    <td>${user.last_name}</td>
                                    <td>${user.email}</td>
                                    <td>${user.phone || '-'}</td>
                                    <td>${user.role.replace('_', ' ')}</td>
                                    <td class="actions-cell">
                                        <button class="btn-action btn-edit" onclick="editUser(${user.id})">Edit</button>
                                        <button class="btn-action btn-delete" onclick="deleteUser(${user.id})">Delete</button>
                                    </td>
                                </tr>
                            `;
                                });

                                // Set up pagination
                                if (data.pagination) {
                                    setupPagination('users', data.pagination.total_pages, data.pagination.page);
                                }
                            } else {
                                tbody.innerHTML = '<tr><td colspan="7">No users found</td></tr>';
                            }
                        })
                        .catch(error => {
                            console.error('Error loading users:', error);
                            tbody.innerHTML = '<tr><td colspan="7">Error loading users. Please try again.</td></tr>';
                        });
                }

                // Function to load artists with pagination
                function loadArtists(page = 1) {
                    const tbody = document.querySelector('#artists-table tbody');
                    tbody.innerHTML = '<tr><td colspan="7">Loading artists...</td></tr>';

                    fetch(`/api/artists?page=${page}&per_page=10`,{
                        credentials: 'include'
                    })
                        .then(response => response.json())
                        .then(data => {
                            if (data.artists && data.artists.length > 0) {
                                tbody.innerHTML = '';
                                data.artists.forEach(artist => {
                                    const currentUser = JSON.parse(localStorage.getItem('user'));
                                    const userRole = currentUser ? currentUser.role : '';

                                    let actionsHtml = `
                                <button class="btn-action btn-view" onclick="viewSongs(${artist.id}, '${artist.name}')">Songs</button>
                            `;

                                    // Add edit/delete buttons only for artist_manager role
                                    if (userRole === 'artist_manager') {
                                        actionsHtml += `
                                    <button class="btn-action btn-edit" onclick="editArtist(${artist.id})">Edit</button>
                                    <button class="btn-action btn-delete" onclick="deleteArtist(${artist.id})">Delete</button>
                                `;
                                    }

                                    tbody.innerHTML += `
                                <tr>
                                    <td>${artist.id}</td>
                                    <td>${artist.name}</td>
                                    <td>${artist.gender ? (artist.gender === 'm' ? 'Male' : (artist.gender === 'f' ? 'Female' : 'Other')) : '-'}</td>
                                    <td>${artist.address || '-'}</td>
                                    <td>${artist.first_release_year || '-'}</td>
                                    <td>${artist.no_of_albums_released || '0'}</td>
                                    <td class="actions-cell">
                                        ${actionsHtml}
                                    </td>
                                </tr>
                            `;
                                });

                                // Set up pagination
                                if (data.pagination) {
                                    setupPagination('artists', data.pagination.total_pages, data.pagination.page);
                                }
                            } else {
                                tbody.innerHTML = '<tr><td colspan="7">No artists found</td></tr>';
                            }
                        })
                        .catch(error => {
                            console.error('Error loading artists:', error);
                            tbody.innerHTML = '<tr><td colspan="7">Error loading artists. Please try again.</td></tr>';
                        });
                }

                // Function to load songs for an artist with pagination
                function loadSongs(artistId, artistName, page = 1) {
                    const tbody = document.querySelector('#songs-table tbody');
                    tbody.innerHTML = '<tr><td colspan="6">Loading songs...</td></tr>';

                    currentArtistForSongs = { id: artistId, name: artistName };
                    document.getElementById('artist-name-for-songs').textContent = artistName;

                    fetch(`/api/artists/${artistId}/music?page=${page}&per_page=10`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.music && data.music.length > 0) {
                                tbody.innerHTML = '';
                                data.music.forEach(song => {
                                    const currentUser = JSON.parse(localStorage.getItem('user'));
                                    const userRole = currentUser ? currentUser.role : '';

                                    let actionsHtml = '';

                                    // Add edit/delete buttons only for artist role
                                    if (userRole === 'artist') {
                                        actionsHtml = `
                                    <button class="btn-action btn-edit" onclick="editSong(${song.id}, ${artistId})">Edit</button>
                                    <button class="btn-action btn-delete" onclick="deleteSong(${song.id}, ${artistId})">Delete</button>
                                `;
                                    }

                                    // Format genre for display
                                    let genreDisplay = '-';
                                    if (song.genre) {
                                        const genres = {
                                            'rnb': 'R&B',
                                            'country': 'Country',
                                            'classic': 'Classic',
                                            'jazz': 'Jazz'
                                        };
                                        genreDisplay = genres[song.genre] || song.genre;
                                    }

                                    tbody.innerHTML += `
                                <tr>
                                    <td>${song.id}</td>
                                    <td>${song.title}</td>
                                    <td>${song.album_name || '-'}</td>
                                    <td>${genreDisplay}</td>
                                    <td>${formatDate(song.created_at)}</td>
                                    <td class="actions-cell">
                                        ${actionsHtml}
                                    </td>
                                </tr>
                            `;
                                });

                                // Set up pagination
                                if (data.pagination) {
                                    setupPagination('songs', data.pagination.total_pages, data.pagination.page);
                                }

                                // Show/hide the add song button based on user role
                                const currentUser = JSON.parse(localStorage.getItem('user'));
                                document.getElementById('add-song-btn').style.display =
                                    (currentUser && currentUser.role === 'artist') ? 'block' : 'none';

                            } else {
                                tbody.innerHTML = '<tr><td colspan="6">No songs found for this artist</td></tr>';
                            }
                        })
                        .catch(error => {
                            console.error('Error loading songs:', error);
                            tbody.innerHTML = '<tr><td colspan="6">Error loading songs. Please try again.</td></tr>';
                        });
                }

                // Set up pagination
                function setupPagination(type, totalPages, currentPage) {
                    const container = document.getElementById(`${type}-pagination`);
                    if (!container) return;

                    container.innerHTML = '';

                    if (totalPages <= 1) return;

                    // Previous button
                    if (currentPage > 1) {
                        const prevButton = document.createElement('button');
                        prevButton.className = 'pagination-button';
                        prevButton.innerHTML = '&laquo;';
                        prevButton.addEventListener('click', function () {
                            if (type === 'users') loadUsers(currentPage - 1);
                            else if (type === 'artists') loadArtists(currentPage - 1);
                            else if (type === 'songs') loadSongs(currentArtistForSongs.id, currentArtistForSongs.name, currentPage - 1);
                        });
                        container.appendChild(prevButton);
                    }

                    // Page buttons
                    for (let i = 1; i <= totalPages; i++) {
                        if (totalPages > 7) {
                            // Skip some pages for large pagination
                            if (i > 2 && i < currentPage - 1) {
                                if (i === 3) {
                                    const ellipsis = document.createElement('span');
                                    ellipsis.className = 'pagination-ellipsis';
                                    ellipsis.textContent = '...';
                                    container.appendChild(ellipsis);
                                }
                                continue;
                            }

                            if (i > currentPage + 1 && i < totalPages - 1) {
                                if (i === currentPage + 2) {
                                    const ellipsis = document.createElement('span');
                                    ellipsis.className = 'pagination-ellipsis';
                                    ellipsis.textContent = '...';
                                    container.appendChild(ellipsis);
                                }
                                continue;
                            }
                        }

                        const pageButton = document.createElement('button');
                        pageButton.className = 'pagination-button';
                        if (i === currentPage) pageButton.classList.add('active');
                        pageButton.textContent = i;
                        pageButton.addEventListener('click', function () {
                            if (i !== currentPage) {
                                if (type === 'users') loadUsers(i);
                                else if (type === 'artists') loadArtists(i);
                                else if (type === 'songs') loadSongs(currentArtistForSongs.id, currentArtistForSongs.name, i);
                            }
                        });
                        container.appendChild(pageButton);
                    }

                    // Next button
                    if (currentPage < totalPages) {
                        const nextButton = document.createElement('button');
                        nextButton.className = 'pagination-button';
                        nextButton.innerHTML = '&raquo;';
                        nextButton.addEventListener('click', function () {
                            if (type === 'users') loadUsers(currentPage + 1);
                            else if (type === 'artists') loadArtists(currentPage + 1);
                            else if (type === 'songs') loadSongs(currentArtistForSongs.id, currentArtistForSongs.name, currentPage + 1);
                        });
                        container.appendChild(nextButton);
                    }
                }

                // Function to view songs for an artist
                function viewSongs(artistId, artistName) {
                    document.getElementById('songs-modal').style.display = 'block';
                    loadSongs(artistId, artistName);
                }

                // Function to edit a user
                function editUser(userId) {
                    document.getElementById('user-modal-title').textContent = 'Edit User';
                    document.getElementById('user-id').value = userId;
                    document.getElementById('password-hint').style.display = 'block';

                    // Fetch user data
                    fetch(`/api/users/${userId}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.user) {
                                const user = data.user;
                                document.getElementById('user-first-name').value = user.first_name || '';
                                document.getElementById('user-last-name').value = user.last_name || '';
                                document.getElementById('user-email').value = user.email || '';
                                document.getElementById('user-password').value = ''; // Don't populate password
                                document.getElementById('user-phone').value = user.phone || '';
                                document.getElementById('user-dob').value = user.dob ? user.dob.split('T')[0] : '';
                                document.getElementById('user-gender').value = user.gender || '';
                                document.getElementById('user-address').value = user.address || '';
                                document.getElementById('user-role').value = user.role || '';

                                document.getElementById('user-modal').style.display = 'block';
                            } else {
                                alert('Error loading user data');
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching user:', error);
                            alert('Error loading user data. Please try again.');
                        });
                }

                // Function to delete a user
                function deleteUser(userId) {
                    if (confirm('Are you sure you want to delete this user?')) {
                        fetch(`/api/users/${userId}`, {
                            method: 'DELETE'
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    loadUsers(); // Reload users list
                                    alert('User deleted successfully');
                                } else {
                                    alert(data.message || 'Failed to delete user');
                                }
                            })
                            .catch(error => {
                                console.error('Error deleting user:', error);
                                alert('Error deleting user. Please try again.');
                            });
                    }
                }

                // Function to edit an artist
                function editArtist(artistId) {
                    document.getElementById('artist-modal-title').textContent = 'Edit Artist';
                    document.getElementById('artist-id').value = artistId;

                    // Fetch artist data
                    fetch(`/api/artists/${artistId}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.artist) {
                                const artist = data.artist;
                                document.getElementById('artist-name').value = artist.name || '';
                                document.getElementById('artist-dob').value = artist.dob ? artist.dob.split('T')[0] : '';
                                document.getElementById('artist-gender').value = artist.gender || '';
                                document.getElementById('artist-address').value = artist.address || '';
                                document.getElementById('artist-first-release').value = artist.first_release_year || '';
                                document.getElementById('artist-albums').value = artist.no_of_albums_released || '0';

                                document.getElementById('artist-modal').style.display = 'block';
                            } else {
                                alert('Error loading artist data');
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching artist:', error);
                            alert('Error loading artist data. Please try again.');
                        });
                }

                // Function to delete an artist
                function deleteArtist(artistId) {
                    if (confirm('Are you sure you want to delete this artist? All associated songs will also be deleted.')) {
                        fetch(`/api/artists/${artistId}`, {
                            method: 'DELETE'
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    loadArtists(); // Reload artists list
                                    alert('Artist deleted successfully');
                                } else {
                                    alert(data.message || 'Failed to delete artist');
                                }
                            })
                            .catch(error => {
                                console.error('Error deleting artist:', error);
                                alert('Error deleting artist. Please try again.');
                            });
                    }
                }

                // Function to edit a song
                function editSong(songId, artistId) {
                    document.getElementById('song-modal-title').textContent = 'Edit Song';
                    document.getElementById('song-id').value = songId;
                    document.getElementById('song-artist-id').value = artistId;

                    // Fetch song data
                    fetch(`/api/music/${songId}`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.music) {
                                const song = data.music;
                                document.getElementById('song-title').value = song.title || '';
                                document.getElementById('song-album').value = song.album_name || '';
                                document.getElementById('song-genre').value = song.genre || '';

                                document.getElementById('song-modal').style.display = 'block';
                            } else {
                                alert('Error loading song data');
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching song:', error);
                            alert('Error loading song data. Please try again.');
                        });
                }

                // Function to delete a song
                function deleteSong(songId, artistId) {
                    if (confirm('Are you sure you want to delete this song?')) {
                        fetch(`/api/music/${songId}`, {
                            method: 'DELETE'
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    loadSongs(artistId, currentArtistForSongs.name); // Reload songs list
                                    alert('Song deleted successfully');
                                } else {
                                    alert(data.message || 'Failed to delete song');
                                }
                            })
                            .catch(error => {
                                console.error('Error deleting song:', error);
                                alert('Error deleting song. Please try again.');
                            });
                    }
                }

                // Global variables
                let currentArtistForSongs = null;

                // Authentication utility functions
                function checkAuth() {
                    return fetch('/api/check-auth')
                        .then(response => response.json())
                        .then(data => {
                            if (data.authenticated && data.user) {
                                // Store user info in localStorage for easy access
                                localStorage.setItem('user', JSON.stringify(data.user));
                                return data.user;
                            } else {
                                localStorage.removeItem('user');
                                return null;
                            }
                        })
                        .catch(error => {
                            console.error('Error checking authentication:', error);
                            localStorage.removeItem('user');
                            return null;
                        });
                }

                function logout() {
                    fetch('/api/logout', {
                        method: 'POST'
                    })
                        .then(() => {
                            localStorage.removeItem('user');
                            window.location.href = '/login.html';
                        })
                        .catch(error => {
                            console.error('Error logging out:', error);
                            alert('Error logging out. Please try again.');
                        });
                }

                // Check authentication on page load
                document.addEventListener('DOMContentLoaded', function () {
                    // Verify user is authenticated
                    checkAuth().then(user => {
                        if (!user) {
                            window.location.href = '/login.html';
                            return;
                        }

                        // Set user info
                        document.getElementById('user-name').textContent = `${user.first_name} ${user.last_name}`;
                        document.getElementById('user-role-display').textContent = user.role.replace('_', ' ');

                        // Show/hide tabs based on user role
                        if (user.role !== 'super_admin') {
                            document.getElementById('tab-users').style.display = 'none';
                            document.getElementById('tab-content-users').classList.remove('active');
                            document.getElementById('tab-artists').classList.add('active');
                            document.getElementById('tab-content-artists').classList.add('active');
                        }

                        // Control permissions for artist actions
                        if (user.role === 'artist') {
                            document.getElementById('add-artist-btn').style.display = 'none';
                            document.getElementById('import-artists-btn').style.display = 'none';
                            document.getElementById('export-artists-btn').style.display = 'none';
                        }

                        // Load initial data
                        if (user.role === 'super_admin') {
                            loadUsers();
                        }

                        loadArtists();
                    });

                    // Set up logout button
                    document.getElementById('logout-btn').addEventListener('click', function () {
                        logout();
                    });

                    // Set up tabs
                    const tabButtons = document.querySelectorAll('.tab-button');
                    tabButtons.forEach(button => {
                        button.addEventListener('click', function () {
                            const tabId = this.getAttribute('data-tab');

                            // Remove active class from all tabs
                            tabButtons.forEach(btn => btn.classList.remove('active'));
                            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                            // Add active class to selected tab
                            this.classList.add('active');
                            document.getElementById(`tab-content-${tabId}`).classList.add('active');
                        });
                    });

                    // Set up modals
                    setupModals();
                });

                // Set up modal functionality
                function setupModals() {
                    // User modal
                    const userModal = document.getElementById('user-modal');
                    const userForm = document.getElementById('user-form');
                    console.log('Form element:', userForm);

                    document.getElementById('add-user-btn').addEventListener('click', function () {
                        document.getElementById('user-modal-title').textContent = 'Add New User';
                        document.getElementById('user-id').value = '';
                        userForm.reset();
                        document.getElementById('password-hint').style.display = 'none';
                        userModal.style.display = 'block';
                    });

                    document.getElementById('user-modal-close').addEventListener('click', function () {
                        userModal.style.display = 'none';
                    });

                    document.getElementById('user-cancel-btn').addEventListener('click', function () {
                        userModal.style.display = 'none';
                    });

                    // userForm.addEventListener('submit', function (e) {
                    //     e.preventDefault();
                    //     console.log('Form submit event triggered');

                    //     const userId = document.getElementById('user-id').value;
                    //     console.log('User ID:', userId);
                    //     const firstName = document.getElementById('user-first-name').value;
                    //     const lastName = document.getElementById('user-last-name').value;
                    //     console.log('First name element:', document.getElementById('user-first-name'));
                    //     console.log('Last name element:', document.getElementById('user-last-name'));

                    //     const email = document.getElementById('user-email').value;
                    //     const password = document.getElementById('user-password').value;
                    //     const phone = document.getElementById('user-phone').value;
                    //     const dob = document.getElementById('user-dob').value;
                    //     const gender = document.getElementById('user-gender').value;
                    //     const address = document.getElementById('user-address').value;
                    //     const role = document.getElementById('user-role').value;

                    //     // Simple validation
                    //     if (!firstName || !lastName || !email || !role) {
                    //         alert('Please fill in all required fields');
                    //         return;
                    //     }

                    //     // Create user data object
                    //     const userData = {
                    //         first_name: firstName,
                    //         last_name: lastName,
                    //         email: email,
                    //         phone: phone,
                    //         dob: dob,
                    //         gender: gender,
                    //         address: address,
                    //         role: role
                    //     };

                    //     // Only include password if provided (for updates)
                    //     if (password) {
                    //         userData.password = password;
                    //     }

                    //     // Call API to save user
                    //     if (userId) {
                    //         // Update existing user
                    //         fetch(`/api/users/${userId}`, {
                    //             method: 'PUT',
                    //             headers: {
                    //                 'Content-Type': 'application/json'
                    //             },
                    //             body: JSON.stringify(userData)
                    //         })
                    //             .then(response => response.json())
                    //             .then(data => {
                    //                 if (data.success) {
                    //                     userModal.style.display = 'none';
                    //                     loadUsers(); // Reload users list
                    //                 } else {
                    //                     alert(data.message || 'Failed to update user');
                    //                 }
                    //             })
                    //             .catch(error => {
                    //                 console.error('Error creating user:', error);
                    //                 alert('Error creating user. Please try again.');
                    //             });
                    //     } else {
                    //         fetch('/api/users', {
                    //             method: 'POST',
                    //             headers: {
                    //                 'Content-Type': 'application/json'
                    //             },
                    //             body: JSON.stringify(userData)
                    //         })
                    //             .then(response => response.json())
                    //             .then(data => {
                    //                 if (data.success) {
                    //                     userModal.style.display = 'none';
                    //                     loadUsers(); // Reload users list
                    //                     alert('User created successfully');
                    //                 } else {
                    //                     alert(data.message || 'Failed to create user');
                    //                 }
                    //             })
                    //             .catch(error => {
                    //                 console.error('Error creating user:', error);
                    //                 alert('Error creating user. Please try again.');
                    //             });
                    //     }
                    // });
                    // Make sure this only runs once
                    if (!window.formHandlersInitialized) {
                        window.formHandlersInitialized = true;

                        document.getElementById('user-form').addEventListener('submit', function (e) {
                            e.preventDefault();
                            console.log('Form submit event triggered');

                            // Capture all form values at once to avoid any potential DOM changes
                            const formData = {
                                userId: document.getElementById('user-id').value,
                                firstName: document.getElementById('user-first-name').value,
                                lastName: document.getElementById('user-last-name').value,
                                email: document.getElementById('user-email').value,
                                password: document.getElementById('user-password').value,
                                phone: document.getElementById('user-phone').value,
                                dob: document.getElementById('user-dob').value,
                                gender: document.getElementById('user-gender').value,
                                address: document.getElementById('user-address').value,
                                role: document.getElementById('user-role').value
                                
                            };
                            console.log('Role element:', document.getElementById('user-role'));
                            console.log('Role value:', document.getElementById('user-role').value);
                            console.log('All elements with ID user-role:', document.querySelectorAll('#user-role'));
                            console.log('All elements with ID user-role:', document.querySelectorAll('#user-role'));

                            console.log('Form data:', formData);

                            // Simple validation
                            if (!formData.firstName || !formData.lastName || !formData.email || !formData.role) {
                                alert('Please fill in all required fields');
                                return;
                            }

                            // Create user data object for API
                            const userData = {
                                first_name: formData.firstName,
                                last_name: formData.lastName,
                                email: formData.email,
                                phone: formData.phone,
                                dob: formData.dob,
                                gender: formData.gender,
                                address: formData.address,
                                role: formData.role
                                
                            };

                            // Only include password if provided
                            if (formData.password) {
                                userData.password = formData.password;
                            }

                            console.log('About to send API request with data:', userData);

                            // Call API to save user
                            if (formData.userId) {
                                // Update existing user
                                fetch(`/api/users/${formData.userId}`, {
                                    method: 'PUT',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify(userData)
                                })
                                    .then(response => response.json())
                                    .then(data => {
                                        console.log('API response:', data);
                                        if (data.success) {
                                            document.getElementById('user-modal').style.display = 'none';
                                            loadUsers();
                                            alert('User updated successfully');
                                        } else {
                                            alert(data.message || 'Failed to update user');
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error updating user:', error);
                                        alert('Error updating user. Please try again.');
                                    });
                            } else {
                                // Create new user
                                console.log('Creating new user');
                                fetch('/api/users', {
                                    method: 'POST',
                                    headers: { 'Content-Type': 'application/json' },
                                    body: JSON.stringify(userData)
                                })
                                    .then(response => {
                                        console.log('Response status:', response.status);
                                        return response.json();
                                    })
                                    .then(data => {
                                        console.log('API response data:', data);
                                        if (data.success) {
                                            document.getElementById('user-modal').style.display = 'none';
                                            loadUsers();
                                            alert('User created successfully');
                                        } else {
                                            alert(data.message || 'Failed to create user');
                                        }
                                    })
                                    .catch(error => {
                                        console.error('Error creating user:', error);
                                        alert('Error creating user. Please try again.');
                                    });
                            }
                        });
                    }

                    // Artist modal
                    const artistModal = document.getElementById('artist-modal');
                    const artistForm = document.getElementById('artist-form');

                    document.getElementById('add-artist-btn').addEventListener('click', function () {
                        document.getElementById('artist-modal-title').textContent = 'Add New Artist';
                        document.getElementById('artist-id').value = '';
                        artistForm.reset();
                        artistModal.style.display = 'block';
                    });

                    document.getElementById('artist-modal-close').addEventListener('click', function () {
                        artistModal.style.display = 'none';
                    });

                    document.getElementById('artist-cancel-btn').addEventListener('click', function () {
                        artistModal.style.display = 'none';
                    });

                    artistForm.addEventListener('submit', function (e) {
                        e.preventDefault();

                        const artistId = document.getElementById('artist-id').value;
                        const name = document.getElementById('artist-name').value;
                        const dob = document.getElementById('artist-dob').value;
                        const gender = document.getElementById('artist-gender').value;
                        const address = document.getElementById('artist-address').value;
                        const firstReleaseYear = document.getElementById('artist-first-release').value;
                        const albumsReleased = document.getElementById('artist-albums').value;

                        // Simple validation
                        if (!name) {
                            alert('Please fill in all required fields');
                            return;
                        }

                        // Create artist data object
                        const artistData = {
                            name: name,
                            dob: dob,
                            gender: gender,
                            address: address,
                            first_release_year: firstReleaseYear,
                            no_of_albums_released: albumsReleased
                        };

                        // Call API to save artist
                        if (artistId) {
                            // Update existing artist
                            fetch(`/api/artists/${artistId}`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(artistData)
                            })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.success) {
                                        artistModal.style.display = 'none';
                                        loadArtists(); // Reload artists list
                                    } else {
                                        alert(data.message || 'Failed to update artist');
                                    }
                                })
                                .catch(error => {
                                    console.error('Error updating artist:', error);
                                    alert('Error updating artist. Please try again.');
                                });
                        } else {
                            // Create new artist
                            fetch('/api/artists', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(artistData)
                            })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.success) {
                                        artistModal.style.display = 'none';
                                        loadArtists(); // Reload artists list
                                    } else {
                                        alert(data.message || 'Failed to create artist');
                                    }
                                })
                                .catch(error => {
                                    console.error('Error creating artist:', error);
                                    alert('Error creating artist. Please try again.');
                                });
                        }
                    });

                    // Songs modal
                    const songsModal = document.getElementById('songs-modal');

                    document.getElementById('songs-modal-close').addEventListener('click', function () {
                        songsModal.style.display = 'none';
                    });

                    document.getElementById('songs-close-btn').addEventListener('click', function () {
                        songsModal.style.display = 'none';
                    });

                    // Song modal
                    const songModal = document.getElementById('song-modal');
                    const songForm = document.getElementById('song-form');

                    document.getElementById('add-song-btn').addEventListener('click', function () {
                        document.getElementById('song-modal-title').textContent = 'Add New Song';
                        document.getElementById('song-id').value = '';
                        document.getElementById('song-artist-id').value = currentArtistForSongs.id;
                        songForm.reset();
                        songModal.style.display = 'block';
                    });

                    document.getElementById('song-modal-close').addEventListener('click', function () {
                        songModal.style.display = 'none';
                    });

                    document.getElementById('song-cancel-btn').addEventListener('click', function () {
                        songModal.style.display = 'none';
                    });

                    songForm.addEventListener('submit', function (e) {
                        e.preventDefault();

                        const songId = document.getElementById('song-id').value;
                        const artistId = document.getElementById('song-artist-id').value;
                        const title = document.getElementById('song-title').value;
                        const album = document.getElementById('song-album').value;
                        const genre = document.getElementById('song-genre').value;

                        // Simple validation
                        if (!title || !genre) {
                            alert('Please fill in all required fields');
                            return;
                        }

                        // Create song data object
                        const songData = {
                            title: title,
                            album_name: album,
                            genre: genre
                        };

                        // Call API to save song
                        if (songId) {
                            // Update existing song
                            fetch(`/api/music/${songId}`, {
                                method: 'PUT',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(songData)
                            })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.success) {
                                        songModal.style.display = 'none';
                                        loadSongs(artistId, currentArtistForSongs.name); // Reload songs list
                                    } else {
                                        alert(data.message || 'Failed to update song');
                                    }
                                })
                                .catch(error => {
                                    console.error('Error updating song:', error);
                                    alert('Error updating song. Please try again.');
                                });
                        } else {
                            // Create new song
                            fetch(`/api/artists/${artistId}/music`, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(songData)
                            })
                                .then(response => response.json())
                                .then(data => {
                                    if (data.success) {
                                        songModal.style.display = 'none';
                                        loadSongs(artistId, currentArtistForSongs.name); // Reload songs list
                                    } else {
                                        alert(data.message || 'Failed to create song');
                                    }
                                })
                                .catch(error => {
                                    console.error('Error creating song:', error);
                                    alert('Error creating song. Please try again.');
                                });
                        }
                    });

                    // Import CSV Modal
                    const importModal = document.getElementById('import-modal');
                    const importForm = document.getElementById('import-form');

                    document.getElementById('import-artists-btn').addEventListener('click', function () {
                        importModal.style.display = 'block';
                    });

                    document.getElementById('import-modal-close').addEventListener('click', function () {
                        importModal.style.display = 'none';
                    });

                    document.getElementById('import-cancel-btn').addEventListener('click', function () {
                        importModal.style.display = 'none';
                    });

                    importForm.addEventListener('submit', function (e) {
                        e.preventDefault();

                        const fileInput = document.getElementById('csv-file');
                        const file = fileInput.files[0];

                        if (!file) {
                            alert('Please select a CSV file');
                            return;
                        }

                        // Create form data for file upload
                        const formData = new FormData();
                        formData.append('csv_file', file);

                        fetch('/api/artists/import', {
                            method: 'POST',
                            body: formData
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    importModal.style.display = 'none';
                                    alert(data.message || 'Artists imported successfully');
                                    loadArtists(); // Reload artists list
                                } else {
                                    alert(data.message || 'Failed to import CSV');
                                }
                            })
                            .catch(error => {
                                console.error('Error importing CSV:', error);
                                alert('Error importing CSV. Please try again.');
                            });
                    });

                    // Export CSV functionality
                    document.getElementById('export-artists-btn').addEventListener('click', function () {
                        window.location.href = '/api/artists/export';
                    });
                }
            </script>
</body>

</html> {
</div>

<div class="tab-container">
    <div class="tab-buttons">
        <button class="tab-button active" data-tab="users" id="tab-users">Users</button>
        <button class="tab-button" data-tab="artists" id="tab-artists">Artists</button>
    </div>

    <!-- Users Tab -->
    <div class="tab-content active" id="tab-content-users">
        <div class="data-header">
            <h2>User Management</h2>
            <button class="btn-action btn-add" id="add-user-btn">Add User</button>
        </div>

        <table class="data-table" id="users-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                    <th>Role</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- User data will be loaded here dynamically -->
                <tr>
                    <td colspan="7">Loading users...</td>
                </tr>
            </tbody>
        </table>

        <div class="pagination" id="users-pagination">
            <!-- Pagination will be added here dynamically -->
        </div>
    </div>

    <!-- Artists Tab -->
    <div class="tab-content" id="tab-content-artists">
        <div class="data-header">
            <h2>Artist Management</h2>
            <div>
                <button class="btn-action" id="import-artists-btn">Import CSV</button>
                <button class="btn-action" id="export-artists-btn">Export CSV</button>
                <button class="btn-action btn-add" id="add-artist-btn">Add Artist</button>
            </div>
        </div>

        <table class="data-table" id="artists-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Name</th>
                    <th>Gender</th>
                    <th>Address</th>
                    <th>First Release Year</th>
                    <th>Albums Released</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Artist data will be loaded here dynamically -->
                <tr>
                    <td colspan="7">Loading artists...</td>
                </tr>
            </tbody>
        </table>

        <div class="pagination" id="artists-pagination">
            <!-- Pagination will be added here dynamically -->
        </div>
    </div>
</div>
</div>

<!-- User Modal -->
<div class="modal" id="user-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="user-modal-title">Add New User</h3>
            <button class="modal-close" id="user-modal-close">&times;</button>
        </div>
        <form id="user-form">
            <input type="hidden" id="user-id">

            <div class="form-row">
                <div class="form-group">
                    <label for="user-first-name">First Name</label>
                    <input type="text" class="form-control" id="user-first-name" placeholder="Enter first name"
                        required>
                </div>

                <div class="form-group">
                    <label for="user-last-name">Last Name</label>
                    <input type="text" class="form-control" id="user-last-name" placeholder="Enter last name" required>
                </div>
            </div>

            <div class="form-group">
                <label for="user-email">Email</label>
                <input type="email" class="form-control" id="user-email" placeholder="example@email.com" required>
            </div>

            <div class="form-group">
                <label for="user-password">Password</label>
                <input type="password" class="form-control" id="user-password" placeholder="Enter password">
                <small class="form-text" id="password-hint">Leave blank to keep current password when editing.</small>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="user-phone">Phone</label>
                    <input type="text" class="form-control" id="user-phone" placeholder="(123) 456-7890">
                </div>

                <div class="form-group">
                    <label for="user-dob">Date of Birth</label>
                    <input type="date" class="form-control" id="user-dob">
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="user-gender">Gender</label>
                    <select class="form-control" id="user-gender">
                        <option value="">Select Gender</option>
                        <option value="m">Male</option>
                        <option value="f">Female</option>
                        <option value="o">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="user-role">Role</label>
                    <select class="form-control" id="user-role" required>
                        <option value="">Select Role</option>
                        <option value="super_admin">Super Admin</option>
                        <option value="artist_manager">Artist Manager</option>
                        <option value="artist">Artist</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="user-address">Address</label>
                <textarea class="form-control" id="user-address" rows="2" placeholder="Enter address"></textarea>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="user-cancel-btn">Cancel</button>
                <button type="submit" class="btn btn-primary">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Artist Modal -->
<div class="modal" id="artist-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="artist-modal-title">Add New Artist</h3>
            <button class="modal-close" id="artist-modal-close">&times;</button>
        </div>
        <form id="artist-form">
            <input type="hidden" id="artist-id">
            <div class="form-group">
                <label for="artist-name">Name</label>
                <input type="text" class="form-control" id="artist-name" required>
            </div>
            <div class="form-group">
                <label for="artist-dob">Date of Birth</label>
                <input type="date" class="form-control" id="artist-dob">
            </div>
            <div class="form-group">
                <label for="artist-gender">Gender</label>
                <select class="form-control" id="artist-gender">
                    <option value="">Select Gender</option>
                    <option value="m">Male</option>
                    <option value="f">Female</option>
                    <option value="o">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="artist-address">Address</label>
                <textarea class="form-control" id="artist-address" rows="2"></textarea>
            </div>
            <div class="form-group">
                <label for="artist-first-release">First Release Year</label>
                <input type="number" class="form-control" id="artist-first-release" min="1900" max="2099">
            </div>
            <div class="form-group">
                <label for="artist-albums">Number of Albums Released</label>
                <input type="number" class="form-control" id="artist-albums" min="0">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" id="artist-cancel-btn">Cancel</button>
                <button type="submit" class="btn">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Songs Modal -->
<div class="modal" id="songs-modal">
    <div class="modal-content song-list-modal">
        <div class="modal-header">
            <h3 class="modal-title" id="songs-modal-title">Songs for <span id="artist-name-for-songs"></span></h3>
            <button class="modal-close" id="songs-modal-close">&times;</button>
        </div>

        <div class="data-header">
            <h4>Songs List</h4>
            <button class="btn-action btn-add" id="add-song-btn">Add Song</button>
        </div>

        <table class="data-table" id="songs-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Title</th>
                    <th>Album Name</th>
                    <th>Genre</th>
                    <th>Created At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Songs data will be loaded here dynamically -->
                <tr>
                    <td colspan="6">Loading songs...</td>
                </tr>
            </tbody>
        </table>

        <div class="pagination" id="songs-pagination">
            <!-- Pagination will be added here dynamically -->
        </div>

        <div class="modal-footer">
            <button type="button" class="btn" id="songs-close-btn">Close</button>
        </div>
    </div>
</div>

<!-- Song Modal -->
<div class="modal" id="song-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="song-modal-title">Add New Song</h3>
            <button class="modal-close" id="song-modal-close">&times;</button>
        </div>
        <form id="song-form">
            <input type="hidden" id="song-id">
            <input type="hidden" id="song-artist-id">
            <div class="form-group">
                <label for="song-title">Title</label>
                <input type="text" class="form-control" id="song-title" required>
            </div>
            <div class="form-group">
                <label for="song-album">Album Name</label>
                <input type="text" class="form-control" id="song-album">
            </div>
            <div class="form-group">
                <label for="song-genre">Genre</label>
                <select class="form-control" id="song-genre" required>
                    <option value="">Select Genre</option>
                    <option value="rnb">R&B</option>
                    <option value="country">Country</option>
                    <option value="classic">Classic</option>
                    <option value="jazz">Jazz</option>
                </select>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" id="song-cancel-btn">Cancel</button>
                <button type="submit" class="btn">Save</button>
            </div>
        </form>
    </div>
</div>

<!-- Import CSV Modal -->
<div class="modal" id="import-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Import Artists CSV</h3>
            <button class="modal-close" id="import-modal-close">&times;</button>
        </div>
        <form id="import-form">
            <div class="form-group">
                <label for="csv-file">Select CSV File</label>
                <input type="file" class="form-control" id="csv-file" accept=".csv" required>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn" id="import-cancel-btn">Cancel</button>
                <button type="submit" class="btn">Import</button>
            </div>
        </form>
    </div>
</div>